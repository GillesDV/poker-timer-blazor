@rendermode InteractiveServer

<MudButton Variant="Variant.Filled" Color="Color.Primary" @onclick="() => ChangeCurrentPlayers(-1)"> -1 </MudButton>
Current players: @CurrentPlayers
<MudButton Variant="Variant.Filled" Color="Color.Primary" @onclick="() => ChangeCurrentPlayers(+1)"> +1 </MudButton>

<br />

<MudButton Variant="Variant.Filled" Color="Color.Primary" @onclick="() => ChangeTotalPlayers(-1)"> -1 </MudButton>
Total players: @TotalPlayers
<MudButton Variant="Variant.Filled" Color="Color.Primary" @onclick="() => ChangeTotalPlayers(+1)"> +1 </MudButton>

<br />
# minute blinds:
<MudRadioGroup T="int" @bind-Value="SelectedBlindTimerInSeconds" >

    <MudRadio Color="Color.Primary" UncheckedColor="Color.Default" Value="600">10</MudRadio>
    <MudRadio Color="Color.Primary" UncheckedColor="Color.Default" Value="900">15</MudRadio>
    <MudRadio Color="Color.Primary" UncheckedColor="Color.Default" Value="1200">20</MudRadio>
    <MudRadio Color="Color.Primary" UncheckedColor="Color.Default" Value="1800">30</MudRadio>
    <MudRadio Color="Color.Primary" UncheckedColor="Color.Default" Value="2700">45</MudRadio>
    <MudRadio Color="Color.Primary" UncheckedColor="Color.Default" Value="3600">60</MudRadio>
    <MudRadio Color="Color.Primary" UncheckedColor="Color.Default" Value="5">5 seconds (demo)</MudRadio>
</MudRadioGroup>

@code {
@using Microsoft.Extensions.Logging
@inject ILogger<AdminInput> _logger

    protected override void OnInitialized()
    {
        _logger.LogDebug("AdminInput Logger initialized");
    }

    [Parameter]
    public int TotalPlayers { get; set; }
    [Parameter]
    public EventCallback<int> TotalPlayersChanged { get; set; }

    private async Task ChangeTotalPlayers(int delta)
    {
        var newValue = TotalPlayers + delta;

        if (newValue > CurrentPlayers && ArePlayerValuesEqual())
        {
            // Can't have more total players than current players -> auto-update currentPlayers, to prevent user needing to double click
            // TODO not super happy with this yet. Kind of mixes conerns of totalPlayers and currentPlayers
            CurrentPlayers = newValue;
            await CurrentPlayersChanged.InvokeAsync(newValue);
        }

        TotalPlayers = newValue;
        await TotalPlayersChanged.InvokeAsync(newValue);
    }

    bool ArePlayerValuesEqual() => CurrentPlayers == TotalPlayers;

    [Parameter]
    public int CurrentPlayers { get; set; }
    [Parameter]
    public EventCallback<int> CurrentPlayersChanged { get; set; }

    private async Task ChangeCurrentPlayers(int delta)
    {
        var newValue = CurrentPlayers + delta;
        CurrentPlayers = newValue;

        await CurrentPlayersChanged.InvokeAsync(newValue);
    }


    [Parameter]
    public int SelectedBlindTimerInSeconds
    {
        get;
        set
        {
            if (field == value) return;
            field = value;
            // forward change to parent (fire-and-forget is fine here)
            _ = SelectedBlindTimerInSecondsChanged.InvokeAsync(value);
        }
    }

    [Parameter]
    public EventCallback<int> SelectedBlindTimerInSecondsChanged { get; set; }

}