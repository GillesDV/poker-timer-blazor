@rendermode InteractiveServer


<div class="py-4 px-6 mx-4 rounded-xl" style="background-color: #F2F7F4; margin-top: 20px;">
    <div style="font-size: 1.5em; padding-bottom: 0.5em;">
        Tournament Info
    </div>

    <div class="d-flex flex-grow-1 gap-4">
        <MudPaper Class="flex-initial d-flex " Style="justify-content: center; box-shadow: none; flex-direction: column; background-color: #F2F7F4" Width="25%">
            <div>
                Total players:
            </div>
            <span style="display:flex; flex-direction: row; justify-content: center; font-size: 1.5em;">
                <MudButton Variant="Variant.Filled" Style="margin: 10px; background-color: white;" @onclick="() => ChangeTotalPlayers(-1)"> -1 </MudButton>
                <div style="margin-top: 13px;">
                    @TotalPlayers
                </div>
                <MudButton Variant="Variant.Filled" Style="margin: 10px; background-color: white;" @onclick="() => ChangeTotalPlayers(+1)"> +1 </MudButton>
            </span>
        </MudPaper>

        <MudPaper Class="flex-initial d-flex " Style="justify-content: center; box-shadow: none; flex-direction: column; background-color: #F2F7F4" Width="25%">
            <div>
                Players Remaining:
            </div>
            <span style="display:flex; flex-direction: row; justify-content: center; font-size: 1.5em;">
                <MudButton Variant="Variant.Filled" Style="margin: 10px; background-color: white;" @onclick="() => ChangeRemainingPlayers(-1)"> -1 </MudButton>
                <div style="margin-top: 13px;">
                    @RemainingPlayers
                </div>
                <MudButton Variant="Variant.Filled" Style="margin: 10px; background-color: white;" @onclick="() => ChangeRemainingPlayers(+1)"> +1 </MudButton>
            </span>
        </MudPaper>

        <MudPaper Class="flex-initial d-flex " Style="justify-content: center; box-shadow: none; flex-direction: column; background-color: #F2F7F4" Width="25%">
            <div>
                Average Stack:
            </div>
            <span style="display:flex; flex-direction: column; justify-content: center; font-size: 1.5em;">

                <div>
                    42K
                </div>

                <div style="font-size: 0.8em; color: darkgrey;">
                    20.4 BB
                </div>
            </span>

        </MudPaper>
        <MudPaper Class="flex-initial d-flex" Style="justify-content: center; box-shadow: none; flex-direction: column; background-color: #F2F7F4" Width="25%">
            <div>
                Timer Controls
            </div>
            <span style="display:flex; flex-direction: column; justify-content: center; font-size: 1.5em;">

                <div>
                    <MudButton Class="rounded-lg" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.PlayArrow"
                               style="background-color: limegreen; color: white;"
                               @onclick="() => TriggerCountdown(true)" disabled="@(IsStartButtonDisabled())">
                        <span style="padding-top: 2px;">
                            Start
                        </span>

                    </MudButton>

                    <MudButton Class="rounded-lg" Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Pause"
                               style="background-color: white; color: limegreen; border: 2px solid limegreen;"
                               @onclick="() => TriggerCountdown(false)" disabled="@(!CountdownIsRunning)">
                        <span style="padding-top: 2px;">
                            Pause
                        </span>
                    </MudButton>
                </div>

                <div style="font-size: 0.8em; color: darkgrey; padding-top: 6px;">
                    <MudButton Class="rounded-lg" Variant="Variant.Outlined" IconColor="Color.Dark" StartIcon="@Icons.Material.Filled.VolumeUp"
                               style="background-color: white; border: 2px solid grey; padding-right: 5px;" />

                    <MudButton Class="rounded-lg" Variant="Variant.Outlined"
                               style="background-color: white; border: 2px solid grey;">
                        Show Chip Values
                    </MudButton>
                </div>
            </span>
        </MudPaper>
    </div>

</div>




@code {
@using Microsoft.Extensions.Logging
@inject ILogger<TournamentInfo> _logger

    protected override void OnInitialized()
    {
        #if (DEBUG)
            _logger.LogDebug("TournamentInfo Logger initialized");
        #endif
    }

    public bool IsStartButtonDisabled()
    {
        if (!BlindTimerHasBeenSelected)
        {
            return true;
        }

        return CountdownIsRunning;
    }

    [Parameter]
    public int TotalPlayers { get; set; }
    [Parameter]
    public EventCallback<int> TotalPlayersChanged { get; set; }

    private async Task ChangeTotalPlayers(int delta)
    {
        var newValue = TotalPlayers + delta;

        if (newValue > RemainingPlayers)
        {
            RemainingPlayers = RemainingPlayers + delta;
            await RemainingPlayersChanged.InvokeAsync(RemainingPlayers);
        }

        TotalPlayers = newValue;
        await TotalPlayersChanged.InvokeAsync(newValue);
    }

    bool ArePlayerValuesEqual() => RemainingPlayers == TotalPlayers;

    [Parameter]
    public int RemainingPlayers { get; set; }
    [Parameter]
    public EventCallback<int> RemainingPlayersChanged { get; set; }

    private async Task ChangeRemainingPlayers(int delta)
    {
        var newValue = RemainingPlayers + delta;
        RemainingPlayers = newValue;

        await RemainingPlayersChanged.InvokeAsync(newValue);
    }

    [Parameter]
    public bool CountdownIsRunning { get; set; }
    [Parameter]
    public EventCallback<bool> CountdownIsRunningChanged { get; set; }

    private async Task TriggerCountdown(bool newValue)
    {
        CountdownIsRunning = newValue;

        await CountdownIsRunningChanged.InvokeAsync(newValue);
    }

    [Parameter] 
    public bool BlindTimerHasBeenSelected { get; init; }

}